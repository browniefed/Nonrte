!function(a){var b=function(){var a,b=[];b=["~","`","!","@","#","$","%","^","&","*","(",")","{","}","[","]","_","-","+","=",":",";",'"',"'","<",",",">",".","?","/","|","\\"];for(var c=0;10>c;c++)b.push(""+c);for(var c=65;90>=c;c++)a=String.fromCharCode(c).toLowerCase(),b.push("shift+"+a),b.push(a);return b}(),c=function(a){return a}(b),d=function(){var a;return a=function(a,b){function c(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function d(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return y[a.which]?y[a.which]:z[a.which]?z[a.which]:String.fromCharCode(a.which).toLowerCase()}function e(a,b){return a.sort().join(",")===b.sort().join(",")}function f(a){a=a||{};var b,c=!1;for(b in E)a[b]?c=!0:E[b]=0;c||(H=!1)}function g(a,b,c,d,f,g){var h,i,j=[],k=c.type;if(!C[a])return[];for("keyup"==k&&n(a)&&(b=[a]),h=0;h<C[a].length;++h)if(i=C[a][h],(d||!i.seq||E[i.seq]==i.level)&&k==i.action&&("keypress"==k&&!c.metaKey&&!c.ctrlKey||e(b,i.modifiers))){var l=!d&&i.combo==f,m=d&&i.seq==d&&i.level==g;(l||m)&&C[a].splice(h,1),j.push(i)}return j}function h(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function i(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function j(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function k(a,b,c,d){J.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(i(b),j(b))}function l(a,b,c){var d,e=g(a,b,c),h={},i=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(i=Math.max(i,e[d].level));for(d=0;d<e.length;++d)if(e[d].seq){if(e[d].level!=i)continue;j=!0,h[e[d].seq]=1,k(e[d].callback,c,e[d].combo,e[d].seq)}else j||k(e[d].callback,c,e[d].combo);var l="keypress"==c.type&&G;c.type!=H||n(a)||l||f(h),G=j&&"keydown"==c.type}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=d(a);if(b)return"keyup"==a.type&&F===b?void(F=!1):void J.handleKey(b,h(a),a)}function n(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function o(){clearTimeout(x),x=setTimeout(f,1e3)}function p(){if(!w){w={};for(var a in y)a>95&&112>a||y.hasOwnProperty(a)&&(w[y[a]]=a)}return w}function q(a,b,c){return c||(c=p()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function r(a,b,c,e){function g(b){return function(){H=b,++E[a],o()}}function h(b){k(c,b,a),"keyup"!==e&&(F=d(b)),setTimeout(f,10)}E[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,l=j?h:g(e||t(b[i+1]).action);u(b[i],l,e,a,i)}}function s(a){return"+"===a?["+"]:a.split("+")}function t(a,b){var c,d,e,f=[];for(c=s(a),e=0;e<c.length;++e)d=c[e],B[d]&&(d=B[d]),b&&"keypress"!=b&&A[d]&&(d=A[d],f.push("shift")),n(d)&&f.push(d);return b=q(d,f,b),{key:d,modifiers:f,action:b}}function u(a,b,c,d,e){D[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,h=a.split(" ");return h.length>1?void r(a,h,b,c):(f=t(a,c),C[f.key]=C[f.key]||[],g(f.key,f.modifiers,{type:f.action},d,a,e),void C[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}function v(a,b,c){for(var d=0;d<a.length;++d)u(a[d],b,c)}for(var w,x,y={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},z={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},B={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},C={},D={},E={},F=!1,G=!1,H=!1,I=1;20>I;++I)y[111+I]="f"+I;for(I=0;9>=I;++I)y[I+96]=I;c(b,"keypress",m),c(b,"keydown",m),c(b,"keyup",m);var J={bind:function(a,b,c){return a=a instanceof Array?a:[a],v(a,b,c),this},unbind:function(a,b){return J.bind(a,function(){},b)},trigger:function(a,b){return D[a+":"+b]&&D[a+":"+b]({},a),this},reset:function(){return C={},D={},this},stopCallback:function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:l};return J}(window,document)}(),e=function(){function a(a){var b;for(b in a)if(a.hasOwnProperty(b))return!0;return!1}function b(a){return function(){throw a}}function c(a,c,d){try{a(c,d)}catch(e){setTimeout(b(e),0)}}function d(a,b,c){a(b,c)}function e(a,b,e,f){var g,h=j[b],i=f?d:c;if(j.hasOwnProperty(b))for(g in h)h.hasOwnProperty(g)&&i(h[g],a,e)}function f(a,b,c){return function(){var d=String(a),f=d.lastIndexOf(".");for(e(a,a,b,c);-1!==f;)d=d.substr(0,f),f=d.lastIndexOf("."),e(a,d,b)}}function g(b){for(var c=String(b),d=Boolean(j.hasOwnProperty(c)&&a(j[c])),e=c.lastIndexOf(".");!d&&-1!==e;)c=c.substr(0,e),e=c.lastIndexOf("."),d=Boolean(j.hasOwnProperty(c)&&a(j[c]));return d}function h(a,b,c,d){var e=f(a,b,d),h=g(a);return h?(c===!0?e():setTimeout(e,0),!0):!1}var i={},j={},k=-1;return i.publish=function(a,b){return h(a,b,!1,i.immediateExceptions)},i.publishSync=function(a,b){return h(a,b,!0,i.immediateExceptions)},i.subscribe=function(a,b){if("function"!=typeof b)return!1;j.hasOwnProperty(a)||(j[a]={});var c="uid_"+String(++k);return j[a][c]=b,c},i.unsubscribe=function(a){var b,c,d,e="string"==typeof a,f=!1;for(b in j)if(j.hasOwnProperty(b)){if(c=j[b],e&&c[a]){delete c[a],f=a;break}if(!e)for(d in c)c.hasOwnProperty(d)&&c[d]===a&&(delete c[d],f=!0)}return f},i}(),f=function(a,b,c){var d=function(){};return d.prototype.init=function(){this.attachGenericKeys(),this.keyHandlers=[]},d.prototype.attachGenericKeys=function(){b.bind(a,this.emitKey.bind(this),"keypress"),b.bind("space",this.emitSpace.bind(this)),b.bind("backspace",this.emitBackspace.bind(this)),b.bind("enter",this.emitEnter.bind(this)),b.bind("up",this.emitUp.bind(this)),b.bind("down",this.emitDown.bind(this)),b.bind("left",this.emitLeft.bind(this)),b.bind("right",this.emitRight.bind(this)),b.bind("mod+b",this.emitBold.bind(this)),b.bind("mod+i",this.emitItalic.bind(this)),b.bind("mod+5",this.emitStrikeThrough.bind(this)),b.bind("mod+u",this.emitUnderline.bind(this))},d.prototype.registerKeyHandler=function(a){this.keyHandlers.push(a)},d.prototype.emitBold=function(a){c.publish("style.bold",a)},d.prototype.emitItalic=function(a){c.publish("style.italic",a)},d.prototype.emitStrikeThrough=function(a){c.publish("style.strikethrough",a)},d.prototype.emitUnderline=function(a){c.publish("style.underline",a)},d.prototype.emitKey=function(a){c.publish("keypress.character",String.fromCharCode(a.which))},d.prototype.emitSpace=function(a){c.publish("keypress.spacebar",a)},d.prototype.emitBackspace=function(a){c.publish("keypress.backspace",a)},d.prototype.emitEnter=function(a){c.publish("keypress.enter",a)},d.prototype.emitUp=function(a){c.publish("keypress.up",a)},d.prototype.emitDown=function(a){c.publish("keypress.down",a)},d.prototype.emitLeft=function(a){c.publish("keypress.left",a)},d.prototype.emitRight=function(a){c.publish("keypress.right",a)},d.prototype,d}(c,d,e),g=function(){var a=function(a,b){a.addEventListener("click",b,!1)};return a}(),h=function(){function a(a,c,d){return c=g(c),i[c]=i[c]||{},i[c][a]&&!d?i[c][a]:i[c][a]=b(a,c)}function b(a,b){return j.style.cssText=k+b,l[a]?j.innerHTML=l[a]:j.innerText=a,j.offsetWidth}function c(a,b,c){{var f=a.charCodeAt(0);f.charCodeAt(0)}a>b?e(d(b,a),c):e(d(b,a),c)}function d(a,b){return String.fromCharCode.apply(String,h(a,b+1))}function e(a,c){var d=a.split(""),e=0;return d.forEach(function(a){e+=b(a,c)}),e}function f(a,c){var d=a.split(""),e=[];return d.forEach(function(a){e.push({character:a,width:b(a,c)})}),e}function g(a){return a.split(";").sort().reverse().join(";")}function h(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f}var i={},j=document.createElement("span"),k="padding: 0; margin: 0; visibility: hidden; position: absolute; left: -6000px;",l={" ":"&nbsp;"};return j.style.cssText=k,document.body.appendChild(j),{getCharacterWidth:a,buildForRange:c,buildForString:e,buildForEachCharacter:f}}(),i=function(a){var b=function(b,c){var d,e,f=0,g=0,h=0,i=Array.prototype.slice.call(b.childNodes),j=!0;return i.forEach(function(b){for(j=!0;j;)"P"==b.tagName?(e=(d="SPAN"==b.childNodes[0].tagName)?a.buildForEachCharacter(d.childNodes[0].data,d.style.cssText):a.buildForEachCharacter(b.childNodes[0].data,"font-size:12px;"),e.forEach(function(a){c>f&&(h=a.character,g=f+=a.width)}),j=!1):j=!1}),{offset:g,clickedCharacter:h}};return b}(h),j=function(){var a=function(a,b,c){return a.substr(0,b)+c+a.substr(b)};return a}(),k=function(){var a={style:function(){return"#"}};return a}(),l=function(){var a={style:function(a){return"~("+a+")"}};return a}(),m=function(){var a={style:function(a){return"^("+a+")"}};return a}(),n=function(){var a={style:function(a){return"+("+a+")"}};return a}(),o=function(){var a={style:function(a){return"=("+a+")"}};return a}(),p=function(){var a={style:function(){return"*"}};return a}(),q=function(){var a={style:function(){return"-"}};return a}(),r=function(){var a={style:function(){return"_"}};return a}(),s=function(a,b,c,d,e,f,g,h){var i={bold:a,color:b,font:c,fontSize:d,highlight:e,italic:f,strikethrough:g,underline:h};return i}(k,l,m,n,o,p,q,r),t=function(a,b,c,d){var e=function(a){return this.linePosition=a,this.node=document.createElement("div"),this.innerLine=document.createElement("div"),this.innerLine.classList.add("nonrte-line-inner"),this.node.classList.add("nonrte-line"),this.textNode=document.createTextNode(""),this.node.appendChild(this.innerLine),this.innerLine.appendChild(this.textNode),this.selection=document.createElement("div"),this.selection.classList.add("nonrte-selection"),this.node.appendChild(this.selection),this.lineSegmentData=[{text:"",styles:{}}],this};return e.prototype.getNode=function(){return this.node},e.prototype.getTextNode=function(){return this.textNode},e.prototype.getLineNode=function(){return this.innerLine},e.prototype.dataLength=function(){return this.textNode.data.length},e.prototype.setLineData=function(a){this.textNode.data=a},e.prototype.setLineHtml=function(a){this.getLineNode().innerHTML=a},e.prototype.addLineSegment=function(){this.lineSegmentData.push({text:"b",styles:{}})},e.prototype.insertCharacter=function(a,b){var c={},e=0,f=d;0==this.lineSegmentData.length?(c.text=a,c.styles={}):this.lineSegmentData.forEach(function(c){var d,g=c.text.length;g+e>=b&&(d=b-e,c.text=f(c.text,d,a)),e+=g})},e.prototype.addStyle=function(a,b,c){2===arguments.length&&"object"==typeof b&&(c=b),c&&(!c.from||c.to&&0!=c.to||(this.getLineDataSegments()[this.getLineDataSegmentsCount()-1].styles[a]=b))},e.prototype.getLineData=function(){return this.textNode.data},e.prototype.getLineDataSegments=function(){return this.lineSegmentData},e.prototype.getLineDataSegmentsCount=function(){return this.getLineDataSegments().length},e.prototype.getPosition=function(){return this.linePosition},e.prototype.getLineHeight=function(){return this.innerLine.clientHeight},e.prototype.highlight=function(a,b){this.selection.style.left=a.offset,this.selection.style.width=b.offset-a.offset+"px"},e.prototype.lineClickHandle=function(){},e}(g,i,e,j,s),u=function(a){var b=function(a){this.el=a,this.lines=[]};return b.prototype.createLine=function(b){var c=this.lines.length,d=this.lines.length===b,e=new a(this.lines.length);return b?this.lines.splice(b,0,e):this.lines.push(e),0===c||d?this.el.appendChild(e.getNode()):this.el.insertBefore(e.getNode(),this.getLine(b+1).getNode()),e},b.prototype.getLine=function(a){return this.lines[a]},b.prototype.getLines=function(){return this.lines},b.prototype.linesLength=function(){return this.lines.length},b}(t),v=function(){var a=function(){var a=0,b={},c=function(c){var d,e,f,g,h,i=0,j=0,k=0;d=document.createDocumentFragment(),e=document.createElement("div"),e.style="width: 6000px; visibility:hidden",f=document.createElement("span"),f.style=c,g=document.createElement("span"),g.appendChild(document.createTextNode("i")),e.appendChild(f),d.appendChild(e),document.body.appendChild(d),f.appendChild(document.createTextNode("f")),f.appendChild(g),i=f.offsetWidth,f.insertBefore(document.createTextNode(" "),g),j=i,i=f.offsetWidth,k=i-j+.4,b["_ "]=k;for(var l=33;126>=l;l++)h=String.fromCharCode(l),f.insertBefore(document.createTextNode(""+h+h),g),j=i,i=f.offsetWidth,k=(i-j)/2,b["_"+h]=k,a<b["_"+h]&&(a=b["_"+h]);document.body.removeChild(e)};c();var d=function(c){return b["_"+c]?b["_"+c]:(b["_"+c]=a,a)};return{getCharacterWidth:d}}();return a}(),w=function(a){var b={standard:"nonrte-cursor",focus:"blink",hidden:"hidden"},c=function(){this.cursorNode=document.createElement("div"),this.cursorNode.classList.add(b.standard),this.cursorNode.classList.add(b.focus)};return c.prototype.positionOnLine=function(a,b){a.getNode().appendChild(this.cursorNode),"number"==typeof b&&this.moveToCharacterPosition(a,b)},c.prototype.position=function(a){this.cursorNode.style.left=a+"px"},c.prototype.moveToCharacterPosition=function(b,c){var d=b.getTextNode().data.split(""),e=0;d.forEach(function(b,d){c>d&&(e+=a.getCharacterWidth(b))}),this.position(e)},c.prototype.setHeight=function(a){this.cursorNode.style.height=a+"px"},c.prototype.hide=function(){this.cursorNode.classList.add("hidden")},c.prototype.show=function(){this.cursorNode.classList.remove("hidden")},c}(v),x=function(){var a=function(){};return a}(v),y=function(){var a=function(a){this.lineHandler=a};return a.prototype.set=function(){},a.prototype.addCharacterToLineEnd=function(){},a.prototype.addCharacterToPositionOnLine=function(){},a.prototype.export=function(){},a}(e),z=function(a){var b=function(a){return a},c=function(a,c){this.fn=c,this.node=a,this.fnMouseMove=b(this.handleMouseMove.bind(this)),this.fnMouseEnd=b(this.handleMouseUp.bind(this)),a.addEventListener("mousedown",this.handleMouseDown.bind(this),!1)};return c.prototype.handleMouseDown=function(b){b.preventDefault(),a.publish("selection.start",b),this.node.addEventListener("mousemove",this.fnMouseMove,!1),this.node.addEventListener("mouseup",this.fnMouseEnd,!1)},c.prototype.handleMouseUp=function(b){b.preventDefault(),a.publish("selection.end",b),this.node.removeEventListener("mousemove",this.fnMouseMove,!1),this.node.removeEventListener("mouseup",this.fnMouseEnd,!1)},c.prototype.handleMouseMove=function(b){b.preventDefault(),a.publish("selection.change",b)},c}(e),A=function(){var a=function(a,b,c){this.line=a,this.from=b,this.to=c};return a}(),B=function(){var a=function(){};return a.prototype.getLineFromOffset=function(){this.lineHandler.getLines()},a.prototype.getRangeOnLine=function(){},a.prototype.highlight=function(){this.selectionRange.forEach(function(){})},a}(A,i),C=function(){var a=function(){function a(a){this.tokens=[],this.tokens.links={},this.options=a||n.defaults,this.rules=o.normal,this.options.gfm&&(this.rules=this.options.tables?o.tables:o.gfm)}function b(a,b){this.options=b||n.defaults,this.links=a,this.rules=p,this.renderer=this.options.styleRenderer||new e,this.renderer.options=this.options}function c(a,b){var c;for(var d in b)b.hasOwnProperty(d)&&(c=a[d]||"",a[d]=c.substr(0,c.length-1)+b[d]+";");return a}function d(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b+=c+":"+a[c]);return b}function e(){}function f(a,c){if(this.options=c||n.defaults,this.links=a,this.rules=r.normal,this.renderer=this.options.renderer||new g,this.renderer.options=this.options,this.styleLexer=new b(a,c),!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?r.breaks:r.gfm:this.options.pedantic&&(this.rules=r.pedantic)}function g(a){this.options=a||{}}function h(a){this.tokens=[],this.token=null,this.options=a||n.defaults,this.options.renderer=this.options.renderer||new g,this.renderer=this.options.renderer,this.renderer.options=this.options}function i(a,b){return a.replace(b?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function j(a){return a.replace(/&([#\w]+);/g,function(a,b){return b=b.toLowerCase(),"colon"===b?":":"#"===b.charAt(0)?String.fromCharCode("x"===b.charAt(1)?parseInt(b.substring(2),16):+b.substring(1)):""})}function k(a,b){return a=a.source,b=b||"",function c(d,e){return d?(e=e.source||e,e=e.replace(/(^|[^\[])\^/g,"$1"),a=a.replace(d,e),c):new RegExp(a,b)}}function l(){}function m(a){for(var b,c,d=1;d<arguments.length;d++){b=arguments[d];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a}function n(b,c,d){if(d||"function"==typeof c){d||(d=c,c=null),c=m({},n.defaults,c||{});var e,f,g=c.highlight,j=0;try{e=a.lex(b,c)}catch(k){return d(k)}f=e.length;var l=function(a){if(a)return c.highlight=g,d(a);var b;try{b=h.parse(e,c)}catch(f){a=f}return c.highlight=g,a?d(a):d(null,b)};if(!g||g.length<3)return l();if(delete c.highlight,!f)return l();for(;j<e.length;j++)!function(a){return"code"!==a.type?--f||l():g(a.text,a.lang,function(b,c){return b?l(b):null==c||c===a.text?--f||l():(a.text=c,a.escaped=!0,void(--f||l()))})}(e[j])}else try{return c&&(c=m({},n.defaults,c)),h.parse(a.lex(b,c),c)}catch(k){if(k.message+="\nPlease report this to https://github.com/chjj/marked.",(c||n.defaults).silent)return"<p>An error occured:</p><pre>"+i(k.message+"",!0)+"</pre>";throw k}}var o={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:l,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:l,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:l,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};o.bullet=/(?:[*+-]|\d+\.)/,o.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,o.item=k(o.item,"gm")(/bull/g,o.bullet)(),o.list=k(o.list)(/bull/g,o.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+o.def.source+")")(),o.blockquote=k(o.blockquote)("def",o.def)(),o._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",o.html=k(o.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,o._tag)(),o.paragraph=k(o.paragraph)("hr",o.hr)("heading",o.heading)("lheading",o.lheading)("blockquote",o.blockquote)("tag","<"+o._tag)("def",o.def)(),o.normal=m({},o),o.gfm=m({},o.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),o.gfm.paragraph=k(o.paragraph)("(?!","(?!"+o.gfm.fences.source.replace("\\1","\\2")+"|"+o.list.source.replace("\\1","\\3")+"|")(),o.tables=m({},o.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),a.rules=o,a.lex=function(b,c){var d=new a(c);return d.lex(b)},a.prototype.lex=function(a){return a=a.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(a,!0)},a.prototype.token=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,a=a.replace(/^ +$/gm,"");a;)if((f=this.rules.newline.exec(a))&&(a=a.substring(f[0].length),f[0].length>1&&this.tokens.push({type:"space"})),f=this.rules.code.exec(a))a=a.substring(f[0].length),f=f[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?f:f.replace(/\n+$/,"")});else if(f=this.rules.fences.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"code",lang:f[2],text:f[3]});else if(f=this.rules.heading.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"heading",depth:f[1].length,text:f[2]});else if(b&&(f=this.rules.nptable.exec(a))){for(a=a.substring(f[0].length),i={type:"table",header:f[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:f[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:f[3].replace(/\n$/,"").split("\n")},k=0;k<i.align.length;k++)i.align[k]=/^ *-+: *$/.test(i.align[k])?"right":/^ *:-+: *$/.test(i.align[k])?"center":/^ *:-+ *$/.test(i.align[k])?"left":null;for(k=0;k<i.cells.length;k++)i.cells[k]=i.cells[k].split(/ *\| */);this.tokens.push(i)}else if(f=this.rules.lheading.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"heading",depth:"="===f[2]?1:2,text:f[1]});else if(f=this.rules.hr.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"hr"});else if(f=this.rules.blockquote.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"blockquote_start"}),f=f[0].replace(/^ *> ?/gm,""),this.token(f,b,!0),this.tokens.push({type:"blockquote_end"});else if(f=this.rules.list.exec(a)){for(a=a.substring(f[0].length),g=f[2],this.tokens.push({type:"list_start",ordered:g.length>1}),f=f[0].match(this.rules.item),d=!1,l=f.length,k=0;l>k;k++)i=f[k],j=i.length,i=i.replace(/^ *([*+-]|\d+\.) +/,""),~i.indexOf("\n ")&&(j-=i.length,i=this.options.pedantic?i.replace(/^ {1,4}/gm,""):i.replace(new RegExp("^ {1,"+j+"}","gm"),"")),this.options.smartLists&&k!==l-1&&(h=o.bullet.exec(f[k+1])[0],g===h||g.length>1&&h.length>1||(a=f.slice(k+1).join("\n")+a,k=l-1)),e=d||/\n\n(?!\s*$)/.test(i),k!==l-1&&(d="\n"===i.charAt(i.length-1),e||(e=d)),this.tokens.push({type:e?"loose_item_start":"list_item_start"}),this.token(i,!1,c),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(f=this.rules.html.exec(a))a=a.substring(f[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===f[1]||"script"===f[1]||"style"===f[1],text:f[0]});else if(!c&&b&&(f=this.rules.def.exec(a)))a=a.substring(f[0].length),this.tokens.links[f[1].toLowerCase()]={href:f[2],title:f[3]};else if(b&&(f=this.rules.table.exec(a))){for(a=a.substring(f[0].length),i={type:"table",header:f[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:f[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:f[3].replace(/(?: *\| *)?\n$/,"").split("\n")},k=0;k<i.align.length;k++)i.align[k]=/^ *-+: *$/.test(i.align[k])?"right":/^ *:-+: *$/.test(i.align[k])?"center":/^ *:-+ *$/.test(i.align[k])?"left":null;for(k=0;k<i.cells.length;k++)i.cells[k]=i.cells[k].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(i)}else if(b&&(f=this.rules.paragraph.exec(a)))a=a.substring(f[0].length),this.tokens.push({type:"paragraph",text:"\n"===f[1].charAt(f[1].length-1)?f[1].slice(0,-1):f[1]});else if(f=this.rules.text.exec(a))a=a.substring(f[0].length),this.tokens.push({type:"text",text:f[0]});else if(a)throw new Error("Infinite loop on byte: "+a.charCodeAt(0));return this.tokens};var p={tag:/(([#|*|\-|_|+|\^|~|\=])(\(([\s\S]+?)\))?)?/,style:/(.)(\(([\s\S]+?)?\))?/};b.rules=p,b.prototype.output=function(a){for(var b,e={};a;)(b=this.rules.tag.exec(a))&&(a=a.substring(b[0].length),e=c(e,this.renderer.style(b[1].match(this.rules.style))));return d(e)};var q={"#":function(){return{"font-weight":"bold"}},"*":function(){return{"font-style":"italic"}},"-":function(){return{"text-decoration":"line-through "}},_:function(){return{"text-decoration":"underline "}},"+":function(a){return{"font-size":a}},"^":function(a){return{"font-family":a}},"~":function(a){return{color:a}},"=":function(a){return{"background-color":a}}};e.prototype.style=function(a){return q[a[1]](a[3])};var r={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:l,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:l,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,styled:/^{\[([\s\S]+?)\]:\s([\s\S]+?)\s:}/};return r._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,r._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,r.link=k(r.link)("inside",r._inside)("href",r._href)(),r.reflink=k(r.reflink)("inside",r._inside)(),r.normal=m({},r),r.pedantic=m({},r.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),r.gfm=m({},r.normal,{escape:k(r.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:k(r.text)("]|","~]|")("|","|https?://|")()}),r.breaks=m({},r.gfm,{br:k(r.br)("{2,}","*")(),text:k(r.gfm.text)("{2,}","*")()}),f.rules=r,f.output=function(a,b,c){var d=new f(b,c);return d.output(a)},f.prototype.output=function(a){for(var b,c,d,e,f="";a;)if(e=this.rules.escape.exec(a))a=a.substring(e[0].length),f+=e[1];else if(e=this.rules.autolink.exec(a))a=a.substring(e[0].length),"@"===e[2]?(c=this.mangle(":"===e[1].charAt(6)?e[1].substring(7):e[1]),d=this.mangle("mailto:")+c):(c=i(e[1]),d=c),f+=this.renderer.link(d,null,c);else if(e=this.rules.styled.exec(a))a=a.substring(e[0].length),f+=this.renderer.styled(this.output(e[2]),this.styleLexer.output(e[1]));else if(this.inLink||!(e=this.rules.url.exec(a))){if(e=this.rules.tag.exec(a))!this.inLink&&/^<a /i.test(e[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(e[0])&&(this.inLink=!1),a=a.substring(e[0].length),f+=this.options.sanitize?i(e[0]):e[0];else if(e=this.rules.link.exec(a))a=a.substring(e[0].length),this.inLink=!0,f+=this.outputLink(e,{href:e[2],title:e[3]}),this.inLink=!1;else if((e=this.rules.reflink.exec(a))||(e=this.rules.nolink.exec(a))){if(a=a.substring(e[0].length),b=(e[2]||e[1]).replace(/\s+/g," "),b=this.links[b.toLowerCase()],!b||!b.href){f+=e[0].charAt(0),a=e[0].substring(1)+a;continue}this.inLink=!0,f+=this.outputLink(e,b),this.inLink=!1}else if(e=this.rules.strong.exec(a))a=a.substring(e[0].length),f+=this.renderer.strong(this.output(e[2]||e[1]));else if(e=this.rules.em.exec(a))a=a.substring(e[0].length),f+=this.renderer.em(this.output(e[2]||e[1]));else if(e=this.rules.code.exec(a))a=a.substring(e[0].length),f+=this.renderer.codespan(i(e[2],!0));else if(e=this.rules.br.exec(a))a=a.substring(e[0].length),f+=this.renderer.br();else if(e=this.rules.del.exec(a))a=a.substring(e[0].length),f+=this.renderer.del(this.output(e[1]));else if(e=this.rules.text.exec(a))a=a.substring(e[0].length),f+=i(this.smartypants(e[0]));else if(a)throw new Error("Infinite loop on byte: "+a.charCodeAt(0))}else a=a.substring(e[0].length),c=i(e[1]),d=c,f+=this.renderer.link(d,null,c);return f},f.prototype.outputLink=function(a,b){var c=i(b.href),d=b.title?i(b.title):null;return"!"!==a[0].charAt(0)?this.renderer.link(c,d,this.output(a[1])):this.renderer.image(c,d,i(a[1]))},f.prototype.smartypants=function(a){return this.options.smartypants?a.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):a},f.prototype.mangle=function(a){for(var b,c="",d=a.length,e=0;d>e;e++)b=a.charCodeAt(e),Math.random()>.5&&(b="x"+b.toString(16)),c+="&#"+b+";";return c},g.prototype.code=function(a,b,c){if(this.options.highlight){var d=this.options.highlight(a,b);null!=d&&d!==a&&(c=!0,a=d)}return b?'<pre><code class="'+this.options.langPrefix+i(b,!0)+'">'+(c?a:i(a,!0))+"\n</code></pre>\n":"<pre><code>"+(c?a:i(a,!0))+"\n</code></pre>"},g.prototype.blockquote=function(a){return"<blockquote>\n"+a+"</blockquote>\n"},g.prototype.html=function(a){return a},g.prototype.heading=function(a,b,c){return"<h"+b+' id="'+this.options.headerPrefix+c.toLowerCase().replace(/[^\w]+/g,"-")+'">'+a+"</h"+b+">\n"},g.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},g.prototype.list=function(a,b){var c=b?"ol":"ul";return"<"+c+">\n"+a+"</"+c+">\n"},g.prototype.listitem=function(a){return"<li>"+a+"</li>\n"},g.prototype.paragraph=function(a){return"<p>"+a+"</p>\n"},g.prototype.table=function(a,b){return"<table>\n<thead>\n"+a+"</thead>\n<tbody>\n"+b+"</tbody>\n</table>\n"},g.prototype.tablerow=function(a){return"<tr>\n"+a+"</tr>\n"},g.prototype.tablecell=function(a,b){var c=b.header?"th":"td",d=b.align?"<"+c+' style="text-align:'+b.align+'">':"<"+c+">";return d+a+"</"+c+">\n"},g.prototype.strong=function(a){return"<strong>"+a+"</strong>"},g.prototype.em=function(a){return"<em>"+a+"</em>"},g.prototype.codespan=function(a){return"<code>"+a+"</code>"},g.prototype.styled=function(a,b){return'<span style="'+b+'">'+a+"</span>"},g.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},g.prototype.del=function(a){return"<del>"+a+"</del>"},g.prototype.link=function(a,b,c){if(this.options.sanitize){try{var d=decodeURIComponent(j(a)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return""}if(0===d.indexOf("javascript:"))return""}var f='<a href="'+a+'"';return b&&(f+=' title="'+b+'"'),f+=">"+c+"</a>"},g.prototype.image=function(a,b,c){var d='<img src="'+a+'" alt="'+c+'"';return b&&(d+=' title="'+b+'"'),d+=this.options.xhtml?"/>":">"},h.parse=function(a,b,c){var d=new h(b,c);return d.parse(a)},h.prototype.parse=function(a){this.inline=new f(a.links,this.options,this.renderer),this.tokens=a.reverse();for(var b="";this.next();)b+=this.tok();return b},h.prototype.next=function(){return this.token=this.tokens.pop()},h.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},h.prototype.parseText=function(){for(var a=this.token.text;"text"===this.peek().type;)a+="\n"+this.next().text;return this.inline.output(a)},h.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var a,b,c,d,e,f="",g="";for(c="",a=0;a<this.token.header.length;a++)d={header:!0,align:this.token.align[a]},c+=this.renderer.tablecell(this.inline.output(this.token.header[a]),{header:!0,align:this.token.align[a]});for(f+=this.renderer.tablerow(c),a=0;a<this.token.cells.length;a++){for(b=this.token.cells[a],c="",e=0;e<b.length;e++)c+=this.renderer.tablecell(this.inline.output(b[e]),{header:!1,align:this.token.align[e]});g+=this.renderer.tablerow(c)}return this.renderer.table(f,g);case"blockquote_start":for(var g="";"blockquote_end"!==this.next().type;)g+=this.tok();return this.renderer.blockquote(g);case"list_start":for(var g="",h=this.token.ordered;"list_end"!==this.next().type;)g+=this.tok();return this.renderer.list(g,h);case"list_item_start":for(var g="";"list_item_end"!==this.next().type;)g+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(g);case"loose_item_start":for(var g="";"list_item_end"!==this.next().type;)g+=this.tok();return this.renderer.listitem(g);case"html":var i=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(i);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},l.exec=l,n.options=n.setOptions=function(a){return m(n.defaults,a),n},n.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new g,xhtml:!1},n.Parser=h,n.parser=h.parse,n.Renderer=g,n.Lexer=a,n.lexer=a.lex,n.InlineLexer=f,n.inlineLexer=f.output,n.parse=n,n}();return a}(),D=function(a,b){function c(a,c){var d,e=c,f="{[",g="]: ",h=" :}",i="";for(d in a)a.hasOwnProperty(d)&&(i+=b[d].style(a[d]));return i?e=f+i+g+e+h:e}var d=function(b){var d=b.getLineDataSegments(),e="";return d.forEach(function(a){e+=c(a.styles,a.text)}),a(e)
};return d}(C,s),E=function(a,b,c,d,e,f,g,h,i,j,k){var l=function(h){this.marked=i,this.element=h,this.keyhandler=new a,this.lineHandler=new b(this.element),this.cursor=new c,this.selectHandler=new g(this.element,this.handleSelect),this.data=new f(this.lineHandler),this.focusPosition={line:0,character:0},d(this),this.cursor.positionOnLine(this.lineHandler.createLine()),this.keyhandler.init(),this.cursor.setHeight(this.lineHandler.getLine(this.focusPosition.line).getLineHeight(this.focusPosition.character)),e.subscribe("keypress.backspace",function(){var a=this.lineHandler.getLine(this.focusPosition.line),b=a.getTextNode();b&&b.length&&this.focusPosition.character-1>=0?(this.focusPosition.character--,b.deleteData(this.focusPosition.character,1)):b&&this.focusPosition.line-1>=0&&(this.focusPosition.line&&this.focusPosition.line--,a=this.lineHandler.getLine(this.focusPosition.line),this.focusPosition.character=a.getTextNode().data.length),this.cursor.positionOnLine(a,this.focusPosition.character)}.bind(this)),e.subscribe("keypress.enter",function(){var a=this.lineHandler.createLine(this.focusPosition.line+1),b=this.lineHandler.getLine(this.focusPosition.line),c=b.getLineData(),d=c.substring(this.focusPosition.character,c.length),e=c.substring(0,this.focusPosition.character);d&&(a.setLineData(d),b.setLineData(e)),this.focusPosition.line+=1,this.focusPosition.character=0,this.cursor.positionOnLine(a,this.focusPosition.character)}.bind(this)),e.subscribe("keypress.spacebar",function(a,b){b.preventDefault(),e.publish("keypress.character"," ")}.bind(this)),e.subscribe("keypress.character",function(a,b){{var c=this.lineHandler.getLine(this.focusPosition.line);c.getLineNode()}c.insertCharacter(b,this.focusPosition.character),c.setLineHtml(j(c)),this.focusPosition.character++}.bind(this)),e.subscribe("lineClick",function(a,b){({target:b.original.target,originalOffset:b.original.target.parentNode.offsetLeft,offsetInisde:b.original.offsetX-b.original.target.parentNode.offsetLeft});this.focusPosition.character=b.characterOffset.clickedCharacter,this.focusPosition.line=b.line.getPosition(),this.cursor.positionOnLine(b.line,this.focusPosition.character)}.bind(this)),e.subscribe("keypress.left",function(){0==this.focusPosition.character&&this.focusPosition.line-1>=0?(this.focusPosition.line--,this.focusPosition.character=this.lineHandler.getLine(this.focusPosition.line).dataLength()):0!=this.focusPosition.character&&this.focusPosition.character--,e.publish("updateCursorPosition")}.bind(this)),e.subscribe("keypress.right",function(){{var a=this.lineHandler.getLine(this.focusPosition.line);a.dataLength()}this.focusPosition.character+1>a.dataLength()&&this.lineHandler.linesLength()<this.focusPosition.line+1?(this.focusPosition.line++,this.focusPosition.character=0):this.focusPosition.character+1<=a.dataLength()&&this.focusPosition.character++,e.publish("updateCursorPosition")}.bind(this)),e.subscribe("keypress.up",function(){{var a,b=this.lineHandler.getLine(this.focusPosition.line);b.dataLength()}this.focusPosition.line-1>=0&&(this.focusPosition.line--,a=this.lineHandler.getLine(this.focusPosition.line),this.focusPosition.character>=a.dataLength()&&(this.focusPosition.character=a.dataLength())),e.publish("updateCursorPosition")}.bind(this)),e.subscribe("keypress.down",function(a,b){b.preventDefault(),b.stopPropagation();{var c,d=this.lineHandler.getLine(this.focusPosition.line);d.dataLength()}this.focusPosition.line+1<this.lineHandler.linesLength()&&(this.focusPosition.line++,c=this.lineHandler.getLine(this.focusPosition.line),this.focusPosition.character>=c.dataLength()&&(this.focusPosition.character=c.dataLength())),e.publish("updateCursorPosition")}.bind(this)),e.subscribe("updateCursorPosition",function(){this.cursor.positionOnLine(this.lineHandler.getLine(this.focusPosition.line),this.focusPosition.character)}.bind(this)),e.subscribe("selection.start",function(a,b){var c=this.lineHandler.getLine(this.focusPosition.line),d=k(c.getLineNode(),b.offsetX);this.startSelection=d}.bind(this)),e.subscribe("selection.change",function(a,b){var c=this.lineHandler.getLine(this.focusPosition.line),d=k(c.getLineNode(),b.offsetX);c.highlight(this.startSelection,d)}.bind(this)),e.subscribe("selection.end",function(a,b){var c=this.lineHandler.getLine(this.focusPosition.line),d=k(c.getLineNode(),b.offsetX);this.endSelection=d,c.highlight(this.startSelection,this.endSelection)}.bind(this)),e.subscribe("style.bold",function(){this.lineHandler.getLine(this.focusPosition.line).addStyle("bold"),e.publish("recompileLine",this.focusPosition.line)}.bind(this)),e.subscribe("style.italic",function(){this.lineHandler.getLine(this.focusPosition.line).addStyle("italic"),e.publish("recompileLine",this.focusPosition.line)}.bind(this)),e.subscribe("style.strikethrough",function(){this.lineHandler.getLine(this.focusPosition.line).addStyle("strikethrough"),e.publish("recompileLine",this.focusPosition.line)}.bind(this)),e.subscribe("style.underline",function(){this.lineHandler.getLine(this.focusPosition.line).addStyle("underline"),e.publish("recompileLine",this.focusPosition.line)}.bind(this)),e.subscribe("recompileLine",function(a,b){var c=this.lineHandler.getLine(b);c.setLineHtml(j(c))}.bind(this))};return l.prototype.handleSelect=function(a,b){var c={x:b.offsetX,y:b.offsetY};"mousedown"===b.type?this.currentSelection=new h(this.lineHandler,c):"mousemove"===b.type},l.prototype.registerKey=function(a,b){this.keyHandler.registerKeyListener(a,b)},l.prototype.registerKeySequence=function(){},l.prototype.registerKeyObserveTrigger=function(a,b){return this.keyHandler.registerKeyListener(a,b),{stop:function(){}}},l}(f,u,w,x,e,y,z,B,C,D,i),F=function(a){return a}(E);"undefined"!=typeof module&&module.exports?module.exports=F:"function"==typeof define&&define.amd?define(function(){return F}):a.NonRTE=F}("undefined"!=typeof window?window:this);